## Telegram‑бот для интеграции с модулем `final` (Odoo)

Этот бот реализует минимальный функционал из ТЗ:

- проверка, привязан ли Telegram‑аккаунт клиента к карточке в Odoo;
- просмотр баланса клиента;
- просмотр предстоящих тренировок (СЦ, корт, тренер, тип, время).

### 1. Предварительные требования

- Python 3.10+;
- доступный снаружи (или через туннель, например ngrok) Odoo 18 с установленным модулем `final`;
- в Odoo должен быть настроен REST API для бота (`/api/tg/balance`, `/api/tg/trainings`)
  и системный параметр `final.tg_bot_api_token`.

### 2. Настройка в Odoo

1. Зайдите под администратором.
2. Откройте **Настройки → Технические → Параметры → Параметры системы**.
3. Создайте (или обновите) параметр:
   - **Ключ**: `final.tg_bot_api_token`
   - **Значение**: любой длинный секретный токен (например, случайная строка).
4. Убедитесь, что Odoo доступен по URL, который вы будете использовать в переменной `ODOO_BASE_URL`
   (например, `http://localhost:8069` или адрес сервера).

Менеджер привязывает клиента к Telegram через поля `Telegram User ID` и `Telegram Username` в форме `res.partner`.

### 3. Установка зависимостей

```bash
cd tg_bot
python -m venv venv
source venv/bin/activate  # в Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### 4. Переменные окружения

Создайте файл `.env` в папке `tg_bot` рядом с `bot.py`:

```env
TG_BOT_TOKEN=ТОКЕН_ВАШЕГО_TELEGRAM_БОТА
ODOO_API_TOKEN=ТОКЕН_ИЗ_FINAL_TG_BOT_API_TOKEN
ODOO_BASE_URL=http://localhost:8069
```

- `TG_BOT_TOKEN` — токен, полученный у `@BotFather`.
- `ODOO_API_TOKEN` — ТОЧНО такое же значение, как в параметре `final.tg_bot_api_token` в Odoo.
- `ODOO_BASE_URL` — URL вашего Odoo (без завершающего `/`).

### 5. Запуск бота

```bash
cd tg_bot
source venv/bin/activate
python bot.py
```

Бот будет работать в режиме long polling.

### 6. Сценарий работы (как в ТЗ)

1. **Менеджер** создаёт клиента в Odoo и заполняет поле **Telegram User ID** числом,
   полученным от клиента (через `@userinfobot` или через нашего бота, который покажет `message.from_user.id`).
2. **Клиент** заходит в Telegram‑бота и пишет `/start`.
3. Бот берёт `telegram_id` пользователя и отправляет запрос в Odoo:
   - если клиент найден — показывает приветствие, баланс и доступные команды;
   - если нет — пишет, что аккаунт не привязан, и показывает клиенту его `Telegram User ID`,
     который нужно передать менеджеру.
4. Команда `/balance` — повторно запрашивает баланс из Odoo.
5. Команда `/my_trainings` — запрашивает список будущих тренировок из Odoo и показывает их
   с указанием СЦ, корта, тренера и типа.

На следующем этапе по ТЗ можно добавить систему уведомлений и напоминаний,
когда Odoo будет вызывать API бота для отправки сообщений клиентам.


